<!DOCTYPE html>
<html>
    <head>
        <title>Token Capture</title>
        <script>
            window.onload = function() {
                const hash = window.location.hash.substring(1);
                const params = new URLSearchParams(hash);
                const token = params.get("access_token");

                if (token) {
                    fetch("/capture_token", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ token: token })
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.json();  // Parse the JSON response
                        } else {
                            throw new Error('Failed to capture token');
                        }
                    })
                    .then(data => {
                        if (data.status === 'success') {
                            document.body.innerHTML = "<h1>Access token renewed. You may now close this tab.</h1>";
                        } else {
                            document.body.innerHTML = "<h1>Token capture failed. Please try again.</h1>";
                        }
                    })
                    .catch(err => {
                        document.body.innerHTML = "<h1>Access token renewal failed. Please try again.</h1>";
                        console.error(err);
                    });
                } else {
                    document.body.innerHTML = "<h1>No access token found.</h1>";
                }
            };
        </script>
    </head>
    <body>
        <h1>Capturing Access Token...</h1>
   Â </body>
</html>